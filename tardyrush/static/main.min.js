function update_csrf(a){if(a.csrf){$("input[name=csrf]").val(a.csrf)}}function update_player_status(e){var d=$(e).parent();var c=d.find("input[name=csrf]").val();var b=d.find("input[name=s]").val();var a=d.attr("action");$.post(a,{csrf:c,s:b,api:"1"},function(i){update_csrf(i);if(i.success){var o=i.player_status_pretty.toLowerCase();var f="status_"+i.match_id+"_"+i.user_id;var k=$("#"+f);k.parent().remove();var j=$("#match_"+i.match_id);var n=null;var g=null;j.find("tr").each(function(){var p=$(this).find("td").last().html();if(p){var q=$.trim(p.toLowerCase());if(!n&&q=="maybe"){n=$(this)}if(!g&&q=="unavailable"){g=$(this)}}});var m=null;if(o=="available"){if(n){m=n}else{if(g){m=g}}}else{if(o=="maybe"){if(g){m=g}}}var l="<tr class='current_user'><td>"+i.user_name+"</td><td id='"+f+"' class='"+o+"'>"+i.player_status_pretty+"</td></tr>";if(m){m.before(l)}else{j.append(l)}j.show();var h="#sb_"+o+"_"+i.match_id;$("#status_buttons_"+i.match_id).find("form").show();$(h).hide()}else{alert("An error has occured. Please try again.")}},"json");return false}function save_form(c){var f=$("#"+c+"_form");var e=f.find("input[name=csrf]").val();data={csrf:e,api:"1"};var b="added";var d=null;if(c=="opponent"){d="Opponent";data.name=f.find("input[name=name]").val();data.tag=f.find("input[name=tag]").val()}else{if(c=="server"){d="Server";data.name=f.find("input[name=name]").val();data.address=f.find("input[name=address]").val()}else{d="Time zone";b="changed";data.time_zone=f.find("select[name=time_zone]").val()}}var a=f.attr("action");$.post(a,data,function(m){update_csrf(m);f.find(".errors").remove();if(m.success){if(c=="time_zone"){$(".full_time_zone").html(m.user_tz_names[0]);$(".abbr_time_zone").html(m.user_tz_names[1])}else{var g=$("<option></option>").attr("value",m[c+"_id"]).text(m[c+"_name"]);var l=$("select#"+c+"_id");var k=l.children("option");var p=m[c+"_name"].toLowerCase();var j=false;for(var h=0;h<k.length;++h){var n=$.trim($(k[h]).html().toLowerCase());if(n>p){$(k[h]).before(g);j=true;break}}if(!j){l.append(g)}l.val(m[c+"_id"])}$.fancybox.close();f.find("input[type=text]").val("");$("#match_form").before('<p id="addflash">'+d+" "+b+" successfully.</p>");$("#addflash").fadeIn(2500).delay(2000).fadeOut(2500);(function(i){setTimeout(function(){i.remove()},5000)}($("#addflash")))}else{$.each(m.errors,function(i,q){var o="<ul class='errors'><li>"+q+"</li></ul>";f.find("input[name="+i+"]").before(o)})}},"json");return false};